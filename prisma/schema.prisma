generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Usuario {
  id                  String         @id @default(cuid())
  email               String         @unique
  password            String
  nombre              String
  telefono            String?
  rol                 String         @default("ALUMNO")
  imagen              String?
  activo              Boolean        @default(true)
  debeCambiarPassword Boolean        @default(true)
  creadoEn            DateTime       @default(now())
  actualizadoEn       DateTime       @updatedAt
  alumno              Alumno?
  clasesDocente       Clase[]        @relation("DocenteClases")
  notificaciones      Notificacion[]

  @@map("usuarios")
}

model Alumno {
  id                        String           @id @default(cuid())
  usuarioId                 String           @unique
  dni                       String?
  fechaNacimiento           DateTime?
  edad                      Int?
  domicilio                 String?
  colegio                   String?
  grado                     String?
  tutorNombre               String?
  tutorDni                  String?
  tutorRelacion             String?
  tutorDomicilio            String?
  tutorTelefonoPrincipal    String?
  tutorTelefonoAlternativo  String?
  tutorEmail                String?
  tutorProfesion            String?
  emergenciaNombre          String?
  emergenciaTelefono        String?
  emergenciaRelacion        String?
  obraSocial                String?
  numeroAfiliado            String?
  hospitalReferencia        String?
  alergias                  String?
  medicacionHabitual        String?
  condicionesMedicas        String?
  restriccionesFisicas      String?
  autorizacionParticipacion Boolean          @default(false)
  autorizacionMedica        Boolean          @default(false)
  autorizacionRetiro        String?
  autorizacionImagenes      Boolean          @default(false)
  aceptacionReglamento      Boolean          @default(false)
  firmaResponsable          String?
  aclaracionFirma           String?
  dniFirma                  String?
  planPago                  String?
  formaPago                 String?
  firmaConformidad          String?
  perfilCompleto            Boolean          @default(false)
  contactoEmergencia        String?
  telefonoEmergencia        String?
  nivel                     String           @default("PRINCIPIANTE")
  notas                     String?
  creadoEn                  DateTime         @default(now())
  actualizadoEn             DateTime         @updatedAt
  usuario                   Usuario          @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  asistencias               Asistencia[]
  citasNivelacion           CitaNivelacion[]
  inscripciones             Inscripcion[]
  obras                     Obra[]
  pagos                     Pago[]

  @@map("alumnos")
}

model Taller {
  id            String        @id @default(cuid())
  nombre        String        @unique
  descripcion   String?
  imagen        String?
  cupoMaximo    Int           @default(10)
  precio        Float         @default(0)
  duracion      Int           @default(90)
  activo        Boolean       @default(true)
  diasSemana    String?
  horaInicio    String?
  creadoEn      DateTime      @default(now())
  actualizadoEn DateTime      @updatedAt
  clases        Clase[]
  inscripciones Inscripcion[]

  @@map("talleres")
}

model Clase {
  id              String       @id @default(cuid())
  tallerId        String
  docenteId       String
  fechaHora       DateTime
  duracionMinutos Int          @default(90)
  ubicacion       String?
  estado          String       @default("PROGRAMADA")
  notas           String?
  creadoEn        DateTime     @default(now())
  actualizadoEn   DateTime     @updatedAt
  asistencias     Asistencia[]
  docente         Usuario      @relation("DocenteClases", fields: [docenteId], references: [id])
  taller          Taller       @relation(fields: [tallerId], references: [id], onDelete: Cascade)
  obras           Obra[]

  @@map("clases")
}

model CitaNivelacion {
  id            String   @id @default(cuid())
  alumnoId      String
  fecha         DateTime
  estado        String   @default("PENDIENTE")
  notas         String?
  creadoEn      DateTime @default(now())
  actualizadoEn DateTime @updatedAt
  alumno        Alumno   @relation(fields: [alumnoId], references: [id], onDelete: Cascade)

  @@map("citas_nivelacion")
}

model Inscripcion {
  id               String   @id @default(cuid())
  alumnoId         String
  tallerId         String
  dia              String?
  horario          String?
  pagado           Boolean  @default(false)
  fechaInscripcion DateTime @default(now())
  estado           String   @default("ACTIVA")
  notas            String?
  fase             String?
  asiento          Int?
  creadoEn         DateTime @default(now())
  actualizadoEn    DateTime @updatedAt
  taller           Taller   @relation(fields: [tallerId], references: [id], onDelete: Cascade)
  alumno           Alumno   @relation(fields: [alumnoId], references: [id], onDelete: Cascade)
  pagos            Pago[]

  @@map("inscripciones")
}

model Asistencia {
  id       String   @id @default(cuid())
  alumnoId String
  claseId  String
  estado   String   @default("PRESENTE")
  notas    String?
  creadoEn DateTime @default(now())
  clase    Clase    @relation(fields: [claseId], references: [id], onDelete: Cascade)
  alumno   Alumno   @relation(fields: [alumnoId], references: [id], onDelete: Cascade)

  @@unique([alumnoId, claseId])
  @@map("asistencias")
}

model Pago {
  id             String      @id @default(cuid())
  alumnoId       String
  inscripcionId  String
  monto          Float
  fechaPago      DateTime    @default(now())
  estado         String      @default("PENDIENTE")
  mercadoPagoId  String?
  comprobantePdf String?
  mesCubierto    Int
  anioCubierto   Int
  concepto       String?
  
  // Datos de Facturación AFIP
  cae            String?     // Código de Autorización Electrónico
  caeVencimiento DateTime?   // Fecha de vencimiento del CAE
  puntoVenta     Int?        // Punto de venta (ej: 1, 2...)
  nroComprobante Int?        // Número correlativo de factura
  tipoFactura    String?     // 'B' para monotributista a consumidor final
  cuitEmisor     String?     // El CUIT con el que se emitió
  emisorNombre   String?     // Para mayor claridad
  facturadoEn    DateTime?   // Fecha de autorización ante AFIP

  creadoEn       DateTime    @default(now())
  actualizadoEn  DateTime    @updatedAt
  inscripcion    Inscripcion @relation(fields: [inscripcionId], references: [id], onDelete: Cascade)
  alumno         Alumno      @relation(fields: [alumnoId], references: [id], onDelete: Cascade)

  @@map("pagos")
}

model Obra {
  id            String   @id @default(cuid())
  alumnoId      String
  claseId       String?
  imagenUrl     String
  titulo        String?
  descripcion   String?
  tecnica       String?
  fechaCreacion DateTime @default(now())
  destacada     Boolean  @default(false)
  creadoEn      DateTime @default(now())
  clase         Clase?   @relation(fields: [claseId], references: [id])
  alumno        Alumno   @relation(fields: [alumnoId], references: [id], onDelete: Cascade)

  @@map("obras")
}

model Notificacion {
  id         String   @id @default(cuid())
  usuarioId  String
  titulo     String
  mensaje    String
  leida      Boolean  @default(false)
  tipo       String?
  enlace     String?
  fechaEnvio DateTime @default(now())
  usuario    Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("notificaciones")
}

model Testimonio {
  id        String   @id @default(cuid())
  nombre    String
  texto     String
  imagen    String?
  destacado Boolean  @default(false)
  activo    Boolean  @default(true)
  creadoEn  DateTime @default(now())

  @@map("testimonios")
}

model Configuracion {
  id          String  @id @default(cuid())
  clave       String  @unique
  valor       String
  descripcion String?

  @@map("configuracion")
}

model Tarea {
  id            String   @id @default(cuid())
  titulo        String
  descripcion   String?
  fecha         DateTime
  completada    Boolean  @default(false)
  prioridad     String   @default("MEDIA")
  creadoEn      DateTime @default(now())
  actualizadoEn DateTime @updatedAt

  @@map("tareas")
}

model SliderImage {
  id          String   @id @default(cuid())
  imagenUrl   String
  titulo      String?
  descripcion String?
  enlace      String?
  orden       Int      @default(0)
  activo      Boolean  @default(true)
  creadoEn    DateTime @default(now())
  actualizadoEn DateTime @updatedAt

  @@map("slider_images")
}

// ==================== TIENDA / E-COMMERCE ====================

model Producto {
  id            String          @id @default(cuid())
  nombre        String
  descripcion   String?
  precio        Float
  imagenUrl     String?
  imagenes      String?         // JSON array de URLs adicionales
  categoria     String          @default("OBRA") // "OBRA" | "MATERIAL"
  stock         Int             @default(1)
  activo        Boolean         @default(true)
  destacado     Boolean         @default(false)
  tecnica       String?         // Para obras: "Óleo", "Acuarela", etc.
  dimensiones   String?         // "30x40 cm"
  artista       String?         @default("Natalia Fusari")
  creadoEn      DateTime        @default(now())
  actualizadoEn DateTime        @updatedAt
  ordenes       OrdenProducto[]

  @@map("productos")
}

model OrdenTienda {
  id              String          @id @default(cuid())
  nombreCliente   String
  emailCliente    String
  telefonoCliente String
  direccion       String?
  total           Float
  estado          String          @default("PENDIENTE") // PENDIENTE, CONFIRMADA, ENVIADA, ENTREGADA, CANCELADA
  notas           String?
  creadoEn        DateTime        @default(now())
  actualizadoEn   DateTime        @updatedAt
  productos       OrdenProducto[]

  @@map("ordenes_tienda")
}

model OrdenProducto {
  id          String      @id @default(cuid())
  ordenId     String
  productoId  String
  cantidad    Int         @default(1)
  precioUnit  Float
  orden       OrdenTienda @relation(fields: [ordenId], references: [id], onDelete: Cascade)
  producto    Producto    @relation(fields: [productoId], references: [id])

  @@map("orden_productos")
}
